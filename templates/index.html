<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Gabaritos - Elo Brindes</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center font-sans">

    <div id="app" class="w-full max-w-lg bg-white p-8 rounded-xl shadow-2xl">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-indigo-900">üñ®Ô∏è Gabarito Maker</h1>
        </div>

        <div class="mb-6">
            <label class="block text-sm font-bold text-gray-700 mb-2">Produto</label>
            <select v-model="produtoSelecionado" class="w-full p-3 border border-gray-300 rounded-lg">
                <option disabled value="">Selecione um produto...</option>
                <option v-for="prod in listaProdutos" :key="prod.id" :value="prod">
                    [[ prod.nome ]] ([[ prod.codigo ]])
                </option>
            </select>
        </div>

        <div v-if="produtoSelecionado" class="bg-indigo-50 p-4 rounded-lg mb-6 text-sm">
            Dimens√µes: <strong>[[ produtoSelecionado.largura ]] mm</strong> x <strong>[[ produtoSelecionado.altura ]] mm</strong>
        </div>

        <button @click="baixarGabarito" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-lg hover:bg-indigo-700 transition">
            <span v-if="!loading">Baixar PDF Agora</span>
            <span v-else>Gerando...</span>
        </button>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            // ISSO AQUI DIZ PRO VUE USAR COLCHETES
            compilerOptions: { delimiters: ['[[', ']]'] },
            data() {
                return {
                    loading: false,
                    produtoSelecionado: '',
                    // O √öNICO LUGAR QUE MANT√âM {{ }} √â AQUI PRO PYTHON
                    listaProdutos: {{ produtos | tojson }} 
                }
            },
            methods: {
                async baixarGabarito() {
                    this.loading = true;
                    try {
                        const response = await fetch('/gerar-gabarito', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                largura: this.produtoSelecionado.largura,
                                altura: this.produtoSelecionado.altura,
                                nome: this.produtoSelecionado.codigo
                            })
                        });
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `Gabarito.pdf`;
                        document.body.appendChild(a);
                        a.click();
                    } catch (e) { alert("Erro"); } 
                    finally { this.loading = false; }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
